<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>PetShop .Net 2 - SerialCoder & NetTiers</title>
    <style type="text/css">
        body {font: 10pt tahoma}
        
        div.authors {font-weight: bold;}
        div.revision {font-style: italic;}
        
        pre.CodeSample {border: 1px #ff9900 dashed; background-color: #ffffdf}
       
        h2 {background-color: #223399; color: white; }
        h3 {color: #003366; padding-left: 10px;}
        h4 {color: #666666; padding-left: 15px;}
        h5 {color: #888888; padding-left: 20px;}
    </style>
</head>
<body>
    <h1>PetShop .Net 2</h1>
    <div class="authors">
        John Roland<br />
        Marc Chouteau<br />
    </div>
    <div class="version">3 dec 2005 - 1.0</div>
    
    <h2>Overview</h2>
    <h3>What is this ?</h3>
    The "PetShop" is a fictional eCommerce website that's supposed to sell pets.
     It also include a small keyword based search engine, a caddy management and some user account related features.<br />

    <h3>Historic</h3>
    The petshop has been developped by many editors, here is a quick history:
    <ul>
        <li>2002 - <a href="http://java.sun.com/reference/blueprints/index.html" target="_blank">Java PetShop</a></li>
        <li>2002 - Microsoft PetShop</li>
        <li>2003 - <a target="_blank" href="http://www.dotnetguru.org/articles/PetShop/PetShopDNG/us/PetShopDNG.htm">DotNetGuru PetShop</a></li>
        <li>2003 - <a target="_blank" href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnbda/html/petshop3x.asp">Microsoft PetShop 3</a></li>
    </ul>
    
    <h3>Why this PetShop ?</h3>
    <h4>ASP.Net 2</h4>
    The arrival of Asp.net 2 deserves on its own a petshop, it is a very huge improvement of the previous version, with both architecture enhancements and extremely powerfull new controls. 
    <br>Among all, we'd like to particulary show :
    <ul>
		<li>Master pages</li>
		<li>ObjectDataSource</li>
		<li>The Provider pattern</li>
		<li>SiteMap</li>
		<li>Profile</li>
		<li>Theming</li>
		<li>Localization</li>
    </ul>
    <br />
    
    <h4>.NetTiers</h4>
    We also want to show how to consume the NetTiers templates, and how it can help on reducing the amount of necessary code and how it can improve the application layering.
    <br/>
    
    <h4>Application design</h4>
    And at last we want to demonstrate how to merge the .Net2 technology and nettiers to setup an application architecture that
     is robust and agile.<br />
    <br />
    <br />
    <br />
           <!--  
    But no misunderstood, with this petshop our intention is not to teach the world the best application design ever. It's too much subjective and IMHO depends mostly of the application 
    your work on.<br />
    Actually we just want to exercise our vision to a standard case study, with some simple rules in mind, like "less code, better code".<br />
    OK, it's not totally true, cause at minimum code must be readable by the other developper,
    and also rely on standard pattern, by in definitive less code mean less code to
    debug, less code to maintain..<br />-->
    <br />
    
    <h2>DataBase</h2>
    Starting from the DotNetGuru implementation, we've just modify some columns name and add some indexes so NetTiers can rely on them to generate additional methods.
    <br />You can also notice the use of TimeStamp columns: they are automatically handled by NetTiers for concurrency management.<br />
    <br /><img src="http://petshopcode.nettiers.com/source/database.png" alt="The petshop database diagram"/><br />
    
    <br />
    <br />
    <br />
        
    
    <h2>ASP.NET 2 PetShop architecture</h2>   
        
    <img src="http://petshopcode.nettiers.com/source/f01boa01.gif" alt="Accessing and representing data in a distributed application"/>
    <br clear="all"/><br />
    This schema is a good representation of how our petshop is layered, here is the mapping between the layer and the projects:    
    
    <ul class="tiers">
        <li>
            <b>The Data tier</b>
            <ul class="layers">
                <li class="dataLayer">The <i>Business Entities Layer</i> contains "object value" classes that are exact representation of our datasource tables and views (generated with nettiers, project: SerialCoder.PetShop)</li>
                <li class="dataLayer">The <i>Data Access Component Layer</i> contains classes (called provider) that are used to load and persits the domain entities (generated with NetTiers, projects: SerialCoder.PetShop.DataAccessLayer, SerialCoder.PetShop.DataAccessLayer.SqlClient)</li>
            </ul>
        </li>
        <li>
            <b>The Business Process tier</b>
            <ul>
                <li class="processLayer">The <i>Business Process Component Layer</i> is a group of class that do some glue between our application, the entities and the DALC. (classes are in the App_Code folder of the website)</li>
            </ul>
        </li>
           <li>
            <b>The Presentation tier</b>
            <ul>
                <li>The presentation tiers is simply our web project, and especially the aspx webforms. (project www) </li>
            </ul>
           </li>    
    </ul>
    
    
    
    <h3>The Data Tier: .NetTiers</h3>
    
    <h4>Presentation</h4>
    Our data tier perspective was mostly influenced by the Pattern and Practicies guide "<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnbda/html/BOAGag.asp" target="_blank">Designing Data Tier Components and Passing Data Through Tiers</a>"
    and we especially like the "Entities vs Data Access Logic Component" pattern cause
    it perfectly match our distributed requirement. [ I will let you refer to this paper to learn more about that.]<br />
    We've soon discover that writing such code was quite repetitive, boring and error-prone.
    Logically we orient ourselves to code generation and finally started an open source project around 
     some starting CodeSmith templates that we've turned into the <a href="http://www.nettiers.com">.NetTiers project</a>.
    (More about CodeSmith <a href="http://www.codesmithtools.com" target="_blank">here</a>)<br />
    The templates goal is to generate a ready to use application block that implement
    the above pattern and thus be a great accelarator.
    <br />
     To be more concrete, lets take a look to a typical use of .NetTiers generated code
    :
<pre class="codeSample">    Product product = new Product();
    product.Name = "my new product";
    product.Price = 19.6;

    DataRepository.ProductProvider.Save(product);

    foreach(Product p in DataRepository.ProductProvider.GetAll())
    {
        Console.WriteLine(p);
    }
</pre>
    
    <h4>Advantages</h4>
    <ul>
        <li>Gain time: code is generated, and testable. You save hours of repetive coding.</li>
        <li>Design: generate project that fit our distributed layering</li>
        <li>Best pratices: Enterprise library, responsability separation, ...</li></ul>
    
    <h4>How to</h4>
    Here is a small five minutes start :<br />
    <ol>
	<!-- it breaks with 2.6 because of the HasPrimaryKey property, so i've commented this out
	<li>Download CodeSmith freeware version <a href="http://www.codesmithtools.com/download/codesmith_26.zip">
            here</a></li> -->
        <li>Download the latest .NetTiers 2 CTP build <a href="www.nettiers.com/nightly.aspx">
            here</a> (nettiers2-CTP-* files)</li>
        <li>Extract and open the "NetTiers.cst" template with CodeSmith explorer</li><li>Set the main properties:
            <ul>
                <li>SourceDatabase: pick the database from which we want to generate</li>
                <li>EntireDatabase: true if we want to generate the code for all the tables and views.</li>
                <li>Namespace: the root namespace for the generated code</li>
                <li>OutputDirectory: the folder to generate files in, i recommend a "NetTiers" subfolder
                    of your project</li>
                <li>CompanyName, CompanyUrl: used for the nDoc documentation</li>
            </ul>
        </li>
        <li>Click on the generate button</li>
        <li>You can now browse the output directory, and open the .sln file</li>
    </ol>
       
    <br />
    
    <h3>The Business Process tier: the App_Code folder</h3>
        <h4>The DataWrapper class</h4>
    <p>
        This class exposes all the data access methods of the application,</p>
        <h4>Provider pattern</h4>
        <h5>Search provider</h5>
        <h5>SiteMap provider</h5>
        
    <h3>The Presentation tier</h3>
        
        <h4>MasterPage</h4>
        <h4>ObjectDataSource</h4>
            
    
    <h2>References</h2>
    http://msdn.microsoft.com/library/default.asp?url=/library/en-us/dnbda/html/BOAGag.asp
    
</body>
</html>

